rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // PDFファイルのルール
    match /pdfs/{fileName} {
      // 読み取りは署名付きURLのみ（Firebase Functionsが生成）
      // 認証されたユーザーまたは有効期限内のリクエスト
      allow read: if request.auth != null || 
                     (resource != null && request.time < resource.metadata.expiresAt);
      
      // 書き込みはFirebase Functionsのみ（サービスアカウント）
      allow write: if false;
    }
    
    // その他のファイルはすべて拒否
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
