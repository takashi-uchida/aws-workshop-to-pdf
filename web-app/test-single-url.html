<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å˜ä¸€URLå¤‰æ› - è‡ªå‹•ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2563eb;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #e5e7eb;
        }
        .test-case.pass {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .test-case.fail {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-case.running {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .summary {
            background: #2563eb;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .summary h2 {
            margin-top: 0;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
        }
        .status.pass {
            background: #10b981;
            color: white;
        }
        .status.fail {
            background: #ef4444;
            color: white;
        }
        .status.running {
            background: #f59e0b;
            color: white;
        }
        .status.pending {
            background: #6b7280;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å˜ä¸€URLå¤‰æ› - è‡ªå‹•ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
        <button id="run-all-btn" onclick="runAllTests()">ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        <button id="clear-btn" onclick="clearResults()">çµæœã‚’ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="summary" id="summary">
        <h2>ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
        <p>åˆæ ¼: <span id="pass-count">0</span> / ä¸åˆæ ¼: <span id="fail-count">0</span> / å®Ÿè¡Œä¸­: <span id="running-count">0</span> / æœªå®Ÿè¡Œ: <span id="pending-count">9</span></p>
        <p>æˆåŠŸç‡: <span id="success-rate">0</span>%</p>
    </div>

    <div class="test-section">
        <h2>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h2>
        
        <div class="test-case pending" id="test-1">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ1: Utils.isValidURL() - æœ‰åŠ¹ãªURL
            </div>
            <div class="test-result" id="result-1"></div>
        </div>

        <div class="test-case pending" id="test-2">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ2: Utils.isValidURL() - ç„¡åŠ¹ãªURL
            </div>
            <div class="test-result" id="result-2"></div>
        </div>

        <div class="test-case pending" id="test-3">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ3: Utils.isValidURL() - ç©ºã®URL
            </div>
            <div class="test-result" id="result-3"></div>
        </div>

        <div class="test-case pending" id="test-4">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ4: Utils.getErrorMessage() - ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
            </div>
            <div class="test-result" id="result-4"></div>
        </div>

        <div class="test-case pending" id="test-5">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ5: Utils.validateSettings() - æœ‰åŠ¹ãªè¨­å®š
            </div>
            <div class="test-result" id="result-5"></div>
        </div>

        <div class="test-case pending" id="test-6">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ6: Utils.checkBrowserCompatibility()
            </div>
            <div class="test-result" id="result-6"></div>
        </div>

        <div class="test-case pending" id="test-7">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ7: PDFConverter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
            </div>
            <div class="test-result" id="result-7"></div>
        </div>

        <div class="test-case pending" id="test-8">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ8: App ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
            </div>
            <div class="test-result" id="result-8"></div>
        </div>

        <div class="test-case pending" id="test-9">
            <div class="test-title">
                <span class="status pending">æœªå®Ÿè¡Œ</span>
                ãƒ†ã‚¹ãƒˆ9: App.loadSettings() - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
            </div>
            <div class="test-result" id="result-9"></div>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/utils.js"></script>
    <script src="js/converter.js"></script>
    <script src="js/batch.js"></script>
    <script src="js/app.js"></script>

    <script>
        let testResults = {
            pass: 0,
            fail: 0,
            running: 0,
            pending: 9
        };

        function updateSummary() {
            document.getElementById('pass-count').textContent = testResults.pass;
            document.getElementById('fail-count').textContent = testResults.fail;
            document.getElementById('running-count').textContent = testResults.running;
            document.getElementById('pending-count').textContent = testResults.pending;
            
            const total = testResults.pass + testResults.fail;
            const successRate = total > 0 ? Math.round((testResults.pass / total) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate;
        }

        function setTestStatus(testId, status, message = '') {
            const testCase = document.getElementById(`test-${testId}`);
            const resultDiv = document.getElementById(`result-${testId}`);
            const statusSpan = testCase.querySelector('.status');
            
            // å‰ã®çŠ¶æ…‹ã‚’ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰æ¸›ç®—
            const prevStatus = testCase.className.split(' ')[1];
            if (prevStatus && testResults[prevStatus] !== undefined) {
                testResults[prevStatus]--;
            }
            
            // æ–°ã—ã„çŠ¶æ…‹ã‚’è¨­å®š
            testCase.className = `test-case ${status}`;
            statusSpan.className = `status ${status}`;
            
            const statusText = {
                pass: 'âœ… åˆæ ¼',
                fail: 'âŒ ä¸åˆæ ¼',
                running: 'â³ å®Ÿè¡Œä¸­',
                pending: 'æœªå®Ÿè¡Œ'
            };
            
            statusSpan.textContent = statusText[status] || status;
            resultDiv.textContent = message;
            
            // æ–°ã—ã„çŠ¶æ…‹ã‚’ã‚«ã‚¦ãƒ³ãƒˆã«è¿½åŠ 
            if (testResults[status] !== undefined) {
                testResults[status]++;
            }
            
            updateSummary();
        }

        async function runTest(testId, testFn) {
            setTestStatus(testId, 'running', 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
            
            try {
                const result = await testFn();
                if (result.pass) {
                    setTestStatus(testId, 'pass', result.message);
                } else {
                    setTestStatus(testId, 'fail', result.message);
                }
            } catch (error) {
                setTestStatus(testId, 'fail', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ãƒ†ã‚¹ãƒˆ1: æœ‰åŠ¹ãªURL
        async function test1() {
            const validUrls = [
                'https://example.com',
                'http://example.com',
                'https://www.example.com/path',
                'https://example.com:8080/path?query=value'
            ];
            
            const results = validUrls.map(url => ({
                url,
                valid: Utils.isValidURL(url)
            }));
            
            const allPass = results.every(r => r.valid);
            
            return {
                pass: allPass,
                message: allPass 
                    ? `ã™ã¹ã¦ã®æœ‰åŠ¹ãªURLãŒæ­£ã—ãæ¤œè¨¼ã•ã‚Œã¾ã—ãŸ\n${results.map(r => `âœ“ ${r.url}`).join('\n')}`
                    : `ä¸€éƒ¨ã®URLã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ\n${results.map(r => `${r.valid ? 'âœ“' : 'âœ—'} ${r.url}`).join('\n')}`
            };
        }

        // ãƒ†ã‚¹ãƒˆ2: ç„¡åŠ¹ãªURL
        async function test2() {
            const invalidUrls = [
                'not-a-url',
                'ftp://example.com',
                'javascript:alert(1)',
                '',
                null,
                undefined
            ];
            
            const results = invalidUrls.map(url => ({
                url: url === null ? 'null' : url === undefined ? 'undefined' : url,
                valid: Utils.isValidURL(url)
            }));
            
            const allPass = results.every(r => !r.valid);
            
            return {
                pass: allPass,
                message: allPass 
                    ? `ã™ã¹ã¦ã®ç„¡åŠ¹ãªURLãŒæ­£ã—ãæ‹’å¦ã•ã‚Œã¾ã—ãŸ\n${results.map(r => `âœ“ ${r.url}`).join('\n')}`
                    : `ä¸€éƒ¨ã®URLã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ\n${results.map(r => `${!r.valid ? 'âœ“' : 'âœ—'} ${r.url}`).join('\n')}`
            };
        }

        // ãƒ†ã‚¹ãƒˆ3: ç©ºã®URL
        async function test3() {
            const emptyUrls = ['', '   ', '\n', '\t'];
            
            const results = emptyUrls.map(url => ({
                url: url === '' ? '(ç©ºæ–‡å­—åˆ—)' : `(ç©ºç™½: "${url}")`,
                valid: Utils.isValidURL(url)
            }));
            
            const allPass = results.every(r => !r.valid);
            
            return {
                pass: allPass,
                message: allPass 
                    ? `ã™ã¹ã¦ã®ç©ºã®URLãŒæ­£ã—ãæ‹’å¦ã•ã‚Œã¾ã—ãŸ`
                    : `ä¸€éƒ¨ã®ç©ºã®URLã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ`
            };
        }

        // ãƒ†ã‚¹ãƒˆ4: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        async function test4() {
            const errorTypes = [
                { type: 'invalid_url', expected: 'ç„¡åŠ¹ãªURL' },
                { type: 'timeout', expected: 'ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ' },
                { type: 'cors', expected: 'CORS' },
                { type: 'network', expected: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯' }
            ];
            
            const results = errorTypes.map(({ type, expected }) => {
                const message = Utils.getErrorMessage(type);
                const contains = message.includes(expected);
                return {
                    type,
                    contains,
                    message: message.substring(0, 50) + '...'
                };
            });
            
            const allPass = results.every(r => r.contains);
            
            return {
                pass: allPass,
                message: allPass 
                    ? `ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¾ã—ãŸ\n${results.map(r => `âœ“ ${r.type}: ${r.message}`).join('\n')}`
                    : `ä¸€éƒ¨ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ\n${results.map(r => `${r.contains ? 'âœ“' : 'âœ—'} ${r.type}`).join('\n')}`
            };
        }

        // ãƒ†ã‚¹ãƒˆ5: è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        async function test5() {
            const validSettings = {
                pageSize: 'A4',
                orientation: 'portrait',
                margins: {
                    top: '1cm',
                    right: '1cm',
                    bottom: '1cm',
                    left: '1cm'
                },
                scale: 1.0,
                printBackground: true
            };
            
            const validation = Utils.validateSettings(validSettings);
            
            return {
                pass: validation.valid,
                message: validation.valid 
                    ? `æœ‰åŠ¹ãªè¨­å®šãŒæ­£ã—ãæ¤œè¨¼ã•ã‚Œã¾ã—ãŸ`
                    : `è¨­å®šã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${validation.errors.join(', ')}`
            };
        }

        // ãƒ†ã‚¹ãƒˆ6: ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
        async function test6() {
            const compatibility = Utils.checkBrowserCompatibility();
            
            return {
                pass: compatibility.compatible,
                message: compatibility.compatible 
                    ? `ãƒ–ãƒ©ã‚¦ã‚¶ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã™\nè­¦å‘Š: ${compatibility.warnings.length}ä»¶`
                    : `ãƒ–ãƒ©ã‚¦ã‚¶ã«éå¯¾å¿œæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™: ${compatibility.unsupportedFeatures.join(', ')}`
            };
        }

        // ãƒ†ã‚¹ãƒˆ7: PDFConverter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
        async function test7() {
            try {
                const converter = new PDFConverter();
                const hasRequiredMethods = 
                    typeof converter.convertToPDF === 'function' &&
                    typeof converter.createIframe === 'function' &&
                    typeof converter.waitForLoad === 'function' &&
                    typeof converter.triggerPrint === 'function' &&
                    typeof converter.cleanup === 'function';
                
                return {
                    pass: hasRequiredMethods,
                    message: hasRequiredMethods 
                        ? `PDFConverterãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã—ãŸ\nã™ã¹ã¦ã®å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™`
                        : `PDFConverterã«å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™`
                };
            } catch (error) {
                return {
                    pass: false,
                    message: `ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã«å¤±æ•—: ${error.message}`
                };
            }
        }

        // ãƒ†ã‚¹ãƒˆ8: App ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
        async function test8() {
            try {
                const app = new App();
                const hasRequiredMethods = 
                    typeof app.init === 'function' &&
                    typeof app.handleSingleConversion === 'function' &&
                    typeof app.handleBatchConversion === 'function' &&
                    typeof app.loadSettings === 'function' &&
                    typeof app.saveSettings === 'function';
                
                const hasRequiredProperties =
                    app.converter instanceof PDFConverter &&
                    app.batchProcessor instanceof BatchProcessor;
                
                return {
                    pass: hasRequiredMethods && hasRequiredProperties,
                    message: (hasRequiredMethods && hasRequiredProperties)
                        ? `AppãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã—ãŸ\nã™ã¹ã¦ã®å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¾ã™`
                        : `Appã«å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ã¾ãŸã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¸è¶³ã—ã¦ã„ã¾ã™`
                };
            } catch (error) {
                return {
                    pass: false,
                    message: `ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã«å¤±æ•—: ${error.message}`
                };
            }
        }

        // ãƒ†ã‚¹ãƒˆ9: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®èª­ã¿è¾¼ã¿
        async function test9() {
            try {
                // localStorageã‚’ã‚¯ãƒªã‚¢
                localStorage.removeItem('pdfConverterSettings');
                
                const app = new App();
                const settings = app.loadSettings();
                
                const hasRequiredSettings =
                    settings.pageSize === 'A4' &&
                    settings.orientation === 'portrait' &&
                    settings.margins &&
                    settings.margins.top === '1cm' &&
                    settings.printBackground === true;
                
                return {
                    pass: hasRequiredSettings,
                    message: hasRequiredSettings 
                        ? `ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ\n${JSON.stringify(settings, null, 2)}`
                        : `ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n${JSON.stringify(settings, null, 2)}`
                };
            } catch (error) {
                return {
                    pass: false,
                    message: `è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`
                };
            }
        }

        async function runAllTests() {
            document.getElementById('run-all-btn').disabled = true;
            
            await runTest(1, test1);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(2, test2);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(3, test3);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(4, test4);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(5, test5);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(6, test6);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(7, test7);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(8, test8);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await runTest(9, test9);
            
            document.getElementById('run-all-btn').disabled = false;
        }

        function clearResults() {
            for (let i = 1; i <= 9; i++) {
                setTestStatus(i, 'pending', '');
            }
            testResults = { pass: 0, fail: 0, running: 0, pending: 9 };
            updateSummary();
        }

        // åˆæœŸåŒ–
        updateSummary();
    </script>
</body>
</html>
