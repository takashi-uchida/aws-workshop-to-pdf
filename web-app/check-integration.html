<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒã‚§ãƒƒã‚¯ - Web to PDF Converter</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .check-item {
            background: white;
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .check-item.success {
            border-left: 4px solid #10b981;
        }
        .check-item.error {
            border-left: 4px solid #ef4444;
        }
        .icon {
            font-size: 24px;
        }
        .details {
            flex: 1;
        }
        .label {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .message {
            font-size: 14px;
            color: #666;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: center;
        }
        .summary h2 {
            margin: 0 0 12px 0;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin-top: 16px;
        }
        .btn:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <h1>ğŸ” çµ±åˆãƒã‚§ãƒƒã‚¯</h1>
    
    <div class="summary" id="summary">
        <h2>ãƒã‚§ãƒƒã‚¯ä¸­...</h2>
    </div>

    <div id="results"></div>

    <script>
        const checks = [];

        function addCheck(label, success, message) {
            checks.push({ label, success, message });
            const resultsDiv = document.getElementById('results');
            const checkDiv = document.createElement('div');
            checkDiv.className = `check-item ${success ? 'success' : 'error'}`;
            checkDiv.innerHTML = `
                <div class="icon">${success ? 'âœ…' : 'âŒ'}</div>
                <div class="details">
                    <div class="label">${label}</div>
                    <div class="message">${message}</div>
                </div>
            `;
            resultsDiv.appendChild(checkDiv);
        }

        function updateSummary() {
            const total = checks.length;
            const passed = checks.filter(c => c.success).length;
            const failed = total - passed;

            const summaryDiv = document.getElementById('summary');
            summaryDiv.innerHTML = `
                <h2>${passed === total ? 'âœ… ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã«åˆæ ¼ã—ã¾ã—ãŸï¼' : 'âš ï¸ ä¸€éƒ¨ã®ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ'}</h2>
                <p>åˆæ ¼: ${passed} / ${total}</p>
                ${passed === total ? '<a href="index.html" class="btn">ã‚¢ãƒ—ãƒªã‚’é–‹ã</a>' : ''}
            `;
        }

        // ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        (function runChecks() {
            // 1. Utils ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒã‚§ãƒƒã‚¯
            if (typeof Utils !== 'undefined') {
                addCheck('Utils ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«', true, 'Utils ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
                
                // Utils ã®é–¢æ•°ãƒã‚§ãƒƒã‚¯
                const utilsFunctions = ['isValidURL', 'parseURLList', 'getErrorMessage', 'validateSettings'];
                const missingFunctions = utilsFunctions.filter(fn => typeof Utils[fn] !== 'function');
                
                if (missingFunctions.length === 0) {
                    addCheck('Utils é–¢æ•°', true, 'ã™ã¹ã¦ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                } else {
                    addCheck('Utils é–¢æ•°', false, `ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°: ${missingFunctions.join(', ')}`);
                }
            } else {
                addCheck('Utils ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«', false, 'Utils ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            }

            // 2. PDFConverter ã‚¯ãƒ©ã‚¹ã®ãƒã‚§ãƒƒã‚¯
            if (typeof PDFConverter !== 'undefined') {
                addCheck('PDFConverter ã‚¯ãƒ©ã‚¹', true, 'PDFConverter ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                
                try {
                    const converter = new PDFConverter();
                    addCheck('PDFConverter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', true, 'PDFConverter ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã«æˆåŠŸã—ã¾ã—ãŸ');
                } catch (error) {
                    addCheck('PDFConverter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            } else {
                addCheck('PDFConverter ã‚¯ãƒ©ã‚¹', false, 'PDFConverter ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            }

            // 3. BatchProcessor ã‚¯ãƒ©ã‚¹ã®ãƒã‚§ãƒƒã‚¯
            if (typeof BatchProcessor !== 'undefined') {
                addCheck('BatchProcessor ã‚¯ãƒ©ã‚¹', true, 'BatchProcessor ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                
                try {
                    const converter = new PDFConverter();
                    const batchProcessor = new BatchProcessor(converter);
                    addCheck('BatchProcessor ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', true, 'BatchProcessor ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã«æˆåŠŸã—ã¾ã—ãŸ');
                } catch (error) {
                    addCheck('BatchProcessor ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            } else {
                addCheck('BatchProcessor ã‚¯ãƒ©ã‚¹', false, 'BatchProcessor ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            }

            // 4. App ã‚¯ãƒ©ã‚¹ã®ãƒã‚§ãƒƒã‚¯
            if (typeof App !== 'undefined') {
                addCheck('App ã‚¯ãƒ©ã‚¹', true, 'App ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
            } else {
                addCheck('App ã‚¯ãƒ©ã‚¹', false, 'App ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            }

            // 5. DOM è¦ç´ ã®ãƒã‚§ãƒƒã‚¯
            const requiredElements = [
                'single-mode-tab',
                'batch-mode-tab',
                'single-url-input',
                'single-convert-btn',
                'batch-url-input',
                'batch-convert-btn',
                'page-size',
                'orientation',
                'progress-section',
                'results-section'
            ];

            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            
            if (missingElements.length === 0) {
                addCheck('DOM è¦ç´ ', true, 'ã™ã¹ã¦ã®å¿…è¦ãª DOM è¦ç´ ãŒå­˜åœ¨ã—ã¾ã™');
            } else {
                addCheck('DOM è¦ç´ ', false, `ä¸è¶³ã—ã¦ã„ã‚‹è¦ç´ : ${missingElements.join(', ')}`);
            }

            // 6. ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
            if (typeof Utils !== 'undefined' && typeof Utils.checkBrowserCompatibility === 'function') {
                const compatibility = Utils.checkBrowserCompatibility();
                
                if (compatibility.compatible) {
                    addCheck('ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§', true, 'ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã™ã¹ã¦ã®å¿…è¦ãªæ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™');
                } else {
                    addCheck('ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§', false, `ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½: ${compatibility.unsupportedFeatures.join(', ')}`);
                }

                if (compatibility.warnings.length > 0) {
                    compatibility.warnings.forEach(warning => {
                        addCheck('ãƒ–ãƒ©ã‚¦ã‚¶è­¦å‘Š', false, warning);
                    });
                }
            }

            // 7. localStorage ãƒã‚§ãƒƒã‚¯
            try {
                const testKey = '__test__';
                localStorage.setItem(testKey, 'test');
                localStorage.removeItem(testKey);
                addCheck('localStorage', true, 'localStorage ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
            } catch (error) {
                addCheck('localStorage', false, 'localStorage ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ï¼ˆè¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã›ã‚“ï¼‰');
            }

            // 8. URL æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
            if (typeof Utils !== 'undefined' && typeof Utils.isValidURL === 'function') {
                const validTest = Utils.isValidURL('https://example.com');
                const invalidTest = !Utils.isValidURL('not-a-url');
                
                if (validTest && invalidTest) {
                    addCheck('URL æ¤œè¨¼', true, 'URL æ¤œè¨¼ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™');
                } else {
                    addCheck('URL æ¤œè¨¼', false, 'URL æ¤œè¨¼ã«å•é¡ŒãŒã‚ã‚Šã¾ã™');
                }
            }

            // 9. URL ãƒ‘ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
            if (typeof Utils !== 'undefined' && typeof Utils.parseURLList === 'function') {
                const testList = `# ã‚³ãƒ¡ãƒ³ãƒˆ
https://example.com

https://www.iana.org
`;
                const parsed = Utils.parseURLList(testList);
                
                if (parsed.length === 2) {
                    addCheck('URL ãƒ‘ãƒ¼ã‚¹', true, 'URL ãƒªã‚¹ãƒˆã®ãƒ‘ãƒ¼ã‚¹ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™');
                } else {
                    addCheck('URL ãƒ‘ãƒ¼ã‚¹', false, `æœŸå¾…: 2å€‹ã®URLã€å®Ÿéš›: ${parsed.length}å€‹`);
                }
            }

            updateSummary();
        })();
    </script>

    <script src="js/utils.js"></script>
    <script src="js/converter.js"></script>
    <script src="js/batch.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
